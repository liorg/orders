model Michal.Project.Models.View.UsersView

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@Styles.Render("~/Content/jqueryui")
@Scripts.Render("~/bundles/jqueryui")
<script>
    /*
 * jQuery UI Autocomplete Auto Select Extension
 *
 * Copyright 2010, Scott González (http://scottgonzalez.com)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * http://github.com/scottgonzalez/jquery-ui-extensions
 */



    $(function () {
        var availableTags = [
          "ActionScript",
          "AppleScript",
          "Asp",
          "BASIC",
          "C",
          "C++",
          "Clojure",
          "COBOL",
          "ColdFusion",
          "Erlang",
          "Fortran",
          "Groovy",
          "Haskell",
          "Java",
          "JavaScript",
          "Lisp",
          "Perl",
          "PHP",
          "Python",
          "Ruby",
          "Scala",
          "Scheme"
        ];
        $("#tags").autocomplete({
            source: availableTags
        });
    });
</script>
<style>
    .ui-autocomplete-loading {
        background: white url("/Content/img/ui-anim_basic_16x16.gif") right center no-repeat;
    }

    /* highlight results */
    .ui-autocomplete span.hl_results {
        background-color: #ffff66;
    }

    /* scroll results */
    .ui-autocomplete {
        max-height: 250px;
        overflow-y: auto;
        /* prevent horizontal scrollbar */
        overflow-x: hidden;
        /* add padding for vertical scrollbar */
        padding-right: 5px;
    }

    .ui-autocomplete li {
            font-size: 16px;
        }

    /* IE 6 doesn't support max-height
* we use height instead, but this forces the menu to always be this tall
*/
    * html .ui-autocomplete {
        height: 250px;
    }

    .ui-autocomplete {
        position: absolute;
        top: 100%;
        left: 0;
        z-index: 1000;
        float: left;
        display: none;
        min-width: 160px;
        _width: 160px;
        padding: 4px 0;
        margin: 2px 0 0 0;
        list-style: none;
        background-color: #ffffff;
        border-color: #ccc;
        border-color: rgba(0, 0, 0, 0.2);
        border-style: solid;
        border-width: 1px;
        -webkit-border-radius: 5px;
        -moz-border-radius: 5px;
        border-radius: 5px;
        -webkit-box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        -moz-box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        -webkit-background-clip: padding-box;
        -moz-background-clip: padding;
        background-clip: padding-box;
        *border-right-width: 2px;
        *border-bottom-width: 2px;
    }

    .ui-menu-item > a.ui-corner-all {
        display: block;
        padding: 3px 15px;
        clear: both;
        font-weight: normal;
        line-height: 18px;
        color: #555555;
        white-space: nowrap;
    }

    .ui-state-hover, &.ui-state-active {
        color: #ffffff;
        text-decoration: none;
        background-color: #0088cc;
        border-radius: 0px;
        -webkit-border-radius: 0px;
        -moz-border-radius: 0px;
        background-image: none;
    }
</style>
<div>

    <div class="ui-widget">
        <label for="country">Country: </label>
        @* <input id="country" />
        (Type "a", "r", "g", "e", "n", "t", "i", "n", "v", "z", "u", "l", "s", "c" or "h")
        <br/>*@
        <label for="city">City: </label>
        <input id="city" />
        <input id="cityCode" />
        (Type "c")
        <br />
        <label for="street">Street: </label>
        <input id="street" /><input id="streetCode" />
        (Type "s")
    </div>
    <script type="text/javascript">
        $(function () {
            function log(message) {
                $("<div>").text(message).prependTo("#log");
                $("#log").scrollTop(0);
            }

            $("#city").bind('autocompleteresponse',
                   function (event, ui) {
                       $("#city").data('menuItems', ui.content);
                   }).blur(function () {
                       debugger;
                       var autocomplete = $("#city").data("uiAutocomplete");
                       var matcher = new RegExp("^"
                               + $.ui.autocomplete.escapeRegex($(this).val())
                               + "$", "i");
                       var menuItems = $(this).data('menuItems');
                       for (idx in menuItems) {
                           var item = menuItems[idx];
                           if (matcher.test(item.value)) {
                               autocomplete.selectedItem = item;
                               break;
                           }
                       }
                       if (autocomplete.selectedItem) {
                           autocomplete._trigger("select", event, {
                               item: autocomplete.selectedItem
                           });
                       } else {
                           $("#streetCode").val("");
                           $("#street").val("");
                           $("#cityCode").val("");
                           $("#city").val("");
                       }
                   }).autocomplete({
                       source: "/api/address/SearchCities",
                       html: true, autoFocus: true, selectFirst: true, autoSelect: true,
                       minLength: 2,
                       open: function (event, ui) {
                           $(".ui-autocomplete").css("z-index", 1000);
                       },
                       select: function (event, ui) {
                           debugger;
                           log(ui.item ? "Selected: " + ui.item.value + " aka " + ui.item.id : "Nothing selected, input was " + this.value);
                           $("#cityCode").val(ui.item.id);

                           $("#streetCode").val("")
                           $("#street").val("");//.prop("disabled", false);
                       },
                       change: function (event, ui) {

                           //   $("#streetCode").val("");
                           //$("#street").val("").prop("disabled", true);
                       }


                   });
            $("#street").autocomplete({
                html: true, autoFocus: true, selectFirst: true, autoSelect: true,
                open: function (event, ui) {
                    // var pfId = $("#cityCode").val();
                    //if (pfId == "") { alert("יש לבחור עיר"); return; }
                    $(".ui-autocomplete").css("z-index", 1000);

                },
                source: function (request, response) {
                    var pfId = $("#cityCode").val();
                    if (pfId == "") {
                        $("#street").removeClass("ui-autocomplete-loading");
                        alert("יש לבחור עיר");

                        request.preventDefault();
                        return false;
                    }
                    $("#street").addClass("ui - autocomplete - loading");
                    $.ajax({
                        url: "/api/address/SearchStreets",
                        dataType: "json",
                        type: 'GET',
                        data: {
                            MaxItems: 12,
                            ParentFilterId: pfId,
                            Term: request.term
                        },
                        success: function (data) {
                            $("#street").removeClass("ui-autocomplete-loading");
                            response(data);
                        }
                    });
                },
                minLength: 2,
                select: function (event, ui) {
                    $("#streetCode").val(ui.item.id);
                    log(ui.item ? "Selected: " + ui.item.value + " aka " + ui.item.id : "Nothing selected, input was " + this.value);
                },
            });

            //  $.cascadingAutocompletes(["#city", "#street"]);
        });
    </script>
</div>
<div class="ui-widget" style="margin-top: 2em; font-family: Arial">
    Result:
  <div id="log" style="height: 200px; width: 300px; overflow: auto;" class="ui-widget-content"></div>
</div>
